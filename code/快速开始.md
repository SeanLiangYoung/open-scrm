# å¿«é€Ÿå¼€å§‹æŒ‡å—

> æœ¬æŒ‡å—å¸®åŠ©ä½ å¿«é€Ÿæ­å»ºå’Œè¿è¡ŒSCRMç³»ç»Ÿçš„å¼€å‘ç¯å¢ƒ

---

## âœ… ç¯å¢ƒæ£€æŸ¥

åœ¨å¼€å§‹ä¹‹å‰ï¼Œç¡®ä¿ä½ çš„ç¯å¢ƒæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š

### å¿…éœ€ç¯å¢ƒ
- **Node.js**: 18.x LTS æˆ–æ›´é«˜ç‰ˆæœ¬
- **pnpm**: 8.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **Git**: ä»»æ„ç‰ˆæœ¬

### å¯é€‰ç¯å¢ƒï¼ˆæ¨èå®‰è£…ï¼‰
- **Docker Desktop**: ç”¨äºè¿è¡ŒMySQL/Redis/MongoDB/RabbitMQ
- **VS Code**: æ¨èçš„IDEï¼Œé…åˆæ’ä»¶ä½¿ç”¨æ›´ä½³

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

æœ¬æ–‡æ¡£å°†æŒ‡å¯¼æ‚¨å¦‚ä½•å¯åŠ¨ SCRM ç³»ç»Ÿçš„å¼€å‘ç¯å¢ƒã€‚

## ğŸ“‹ ç¯å¢ƒè¦æ±‚

- **Node.js**: >= 18.0.0
- **pnpm**: >= 8.0.0
- **MySQL**: 8.0+
- **Redis**: 7.0+
- **Docker** (å¯é€‰ï¼Œç”¨äºå¿«é€Ÿå¯åŠ¨æ•°æ®åº“)

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. å®‰è£…ä¾èµ–

```bash
# å®‰è£… pnpm (å¦‚æœè¿˜æ²¡æœ‰å®‰è£…)
npm install -g pnpm@8

# è¿›å…¥é¡¹ç›®ç›®å½•
cd code

# å®‰è£…æ‰€æœ‰ä¾èµ–
pnpm install
```

### 2. å¯åŠ¨æ•°æ®åº“ (ä½¿ç”¨ Docker)

```bash
# åœ¨ code ç›®å½•ä¸‹æ‰§è¡Œ
docker-compose up -d
```

è¿™å°†å¯åŠ¨ä»¥ä¸‹æœåŠ¡ï¼š
- MySQL (ç«¯å£ 3306)
- Redis (ç«¯å£ 6379)
- MongoDB (ç«¯å£ 27017)
- RabbitMQ (ç«¯å£ 5672, ç®¡ç†ç•Œé¢ 15672)
- Prometheus (ç«¯å£ 9090)
- Grafana (ç«¯å£ 3100)

ç­‰å¾…æœåŠ¡å¯åŠ¨å®Œæˆï¼ˆçº¦30ç§’ï¼‰ï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬ã€‚

### 3. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶
cp services/gateway-service/.env.example services/gateway-service/.env
cp services/auth-service/.env.example services/auth-service/.env

# æ ¹æ®éœ€è¦ä¿®æ”¹é…ç½®
```

### 4. å¯åŠ¨åç«¯æœåŠ¡

#### æ–¹å¼ä¸€ï¼šå¯åŠ¨æ‰€æœ‰æœåŠ¡

```bash
# åœ¨ code ç›®å½•ä¸‹
pnpm dev:service
```

#### æ–¹å¼äºŒï¼šå•ç‹¬å¯åŠ¨æŸä¸ªæœåŠ¡

```bash
# å¯åŠ¨ç½‘å…³æœåŠ¡
cd services/gateway-service
pnpm dev

# æ–°å¼€ç»ˆç«¯ï¼Œå¯åŠ¨è®¤è¯æœåŠ¡
cd services/auth-service
pnpm dev
```

### 5. éªŒè¯æœåŠ¡æ˜¯å¦å¯åŠ¨æˆåŠŸ

è®¿é—®ä»¥ä¸‹åœ°å€æ£€æŸ¥æœåŠ¡çŠ¶æ€ï¼š

- ç½‘å…³æœåŠ¡å¥åº·æ£€æŸ¥: http://localhost:7000/health
- è®¤è¯æœåŠ¡å¥åº·æ£€æŸ¥: http://localhost:7001/health

## ğŸ“¦ æ„å»ºå…±äº«åŒ…

å¦‚æœä¿®æ”¹äº†å…±äº«åŒ…ï¼ˆshared-types, shared-utilsç­‰ï¼‰ï¼Œéœ€è¦é‡æ–°æ„å»ºï¼š

```bash
# åœ¨ code ç›®å½•ä¸‹
cd packages/shared-types
pnpm build

cd ../shared-utils
pnpm build

cd ../shared-constants
pnpm build
```

æˆ–ä½¿ç”¨ Turbo æ‰¹é‡æ„å»ºï¼š

```bash
# åœ¨ code ç›®å½•ä¸‹
pnpm build
```

## ğŸ§ª æµ‹è¯• API

### æµ‹è¯•ç™»å½•æ¥å£

ä½¿ç”¨é»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼ˆå·²é€šè¿‡æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬åˆ›å»ºï¼‰ï¼š

```bash
curl -X POST http://localhost:7000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "Admin@123"
  }'
```

æˆåŠŸè¿”å›ç¤ºä¾‹ï¼š

```json
{
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 1,
    "username": "admin",
    "corpId": 1,
    "isAdmin": 1
  }
}
```

## ğŸ“ å¼€å‘å·¥ä½œæµ

### åˆ›å»ºæ–°çš„å¾®æœåŠ¡

1. åœ¨ `services/` ç›®å½•ä¸‹åˆ›å»ºæ–°æœåŠ¡ç›®å½•
2. å¤åˆ¶ `auth-service` çš„ `package.json` å’Œ `tsconfig.json`
3. ä¿®æ”¹æœåŠ¡åç§°å’Œç«¯å£
4. åˆ›å»º `src` ç›®å½•ç»“æ„
5. è¿è¡Œ `pnpm install`

### ä»£ç è§„èŒƒ

```bash
# ä»£ç æ£€æŸ¥
pnpm lint

# ä»£ç æ ¼å¼åŒ–
pnpm format

# ç±»å‹æ£€æŸ¥
pnpm type-check
```

## ğŸ› å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“è¿æ¥å¤±è´¥

**é—®é¢˜**: `Error: connect ECONNREFUSED 127.0.0.1:3306`

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿ Docker Compose ä¸­çš„ MySQL å·²å¯åŠ¨ï¼š`docker-compose ps`
- æ£€æŸ¥æ•°æ®åº“è¿æ¥é…ç½®ï¼šæŸ¥çœ‹ `.env` æ–‡ä»¶ä¸­çš„ `DB_HOST`, `DB_PORT` ç­‰

### 2. Redis è¿æ¥å¤±è´¥

**é—®é¢˜**: `Error: connect ECONNREFUSED 127.0.0.1:6379`

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿ Redis å·²å¯åŠ¨ï¼š`docker-compose ps`
- æ£€æŸ¥ Redis é…ç½®

### 3. pnpm install å¤±è´¥

**é—®é¢˜**: ä¾èµ–å®‰è£…å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ¸…ç†ç¼“å­˜
pnpm store prune

# åˆ é™¤ node_modules
rm -rf node_modules

# é‡æ–°å®‰è£…
pnpm install
```

### 4. ç«¯å£è¢«å ç”¨

**é—®é¢˜**: `Error: listen EADDRINUSE: address already in use :::7000`

**è§£å†³æ–¹æ¡ˆ**:
- æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹ï¼š`lsof -i :7000` (Mac/Linux) æˆ– `netstat -ano | findstr :7000` (Windows)
- æ€æ­»è¿›ç¨‹æˆ–ä¿®æ”¹æœåŠ¡ç«¯å£é…ç½®

## ğŸ“š ä¸‹ä¸€æ­¥

- é˜…è¯» [å¼€å‘è®¡åˆ’è¡¨.md](../å¼€å‘è®¡åˆ’è¡¨.md) äº†è§£æ•´ä½“å¼€å‘è§„åˆ’
- æŸ¥çœ‹ [éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦](../mvp/éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦.md) äº†è§£ä¸šåŠ¡éœ€æ±‚
- æŸ¥çœ‹å„æœåŠ¡çš„ README äº†è§£è¯¦ç»†å¼€å‘æŒ‡å—

## ğŸ’¡ æç¤º

- ä½¿ç”¨ VSCode çš„ Workspace åŠŸèƒ½æ‰“å¼€é¡¹ç›®ï¼Œå¯ä»¥è·å¾—æ›´å¥½çš„å¼€å‘ä½“éªŒ
- æ¨èå®‰è£… ESLintã€Prettierã€TypeScript ç›¸å…³æ’ä»¶
- å»ºè®®ä½¿ç”¨ Postman æˆ– Apifox ç®¡ç† API æµ‹è¯•

