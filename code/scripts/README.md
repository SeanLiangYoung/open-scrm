# Scripts ç›®å½•è¯´æ˜

æœ¬ç›®å½•åŒ…å«é¡¹ç›®çš„å„ç§è„šæœ¬å·¥å…·ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
scripts/
â”œâ”€â”€ run/                           # è¿è¡Œç›¸å…³è„šæœ¬
â”‚   â”œâ”€â”€ start-all-services.ps1    # å¯åŠ¨æ‰€æœ‰åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ stop-all-services.ps1     # åœæ­¢æ‰€æœ‰åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ check-services.ps1        # æ£€æŸ¥æœåŠ¡çŠ¶æ€
â”‚   â”œâ”€â”€ start-gateway.ps1         # å¯åŠ¨ç½‘å…³æœåŠ¡
â”‚   â”œâ”€â”€ start-auth.ps1            # å¯åŠ¨è®¤è¯æœåŠ¡
â”‚   â”œâ”€â”€ start-customer.ps1        # å¯åŠ¨å®¢æˆ·æœåŠ¡
â”‚   â”œâ”€â”€ start-acquisition.ps1     # å¯åŠ¨è·å®¢æœåŠ¡
â”‚   â”œâ”€â”€ start-operation.ps1       # å¯åŠ¨è¿è¥æœåŠ¡
â”‚   â”œâ”€â”€ start-asset.ps1           # å¯åŠ¨ç´ ææœåŠ¡
â”‚   â”œâ”€â”€ start-message.ps1         # å¯åŠ¨æ¶ˆæ¯æœåŠ¡
â”‚   â”œâ”€â”€ start-integration.ps1     # å¯åŠ¨é›†æˆæœåŠ¡
â”‚   â”œâ”€â”€ start-analytics.ps1       # å¯åŠ¨åˆ†ææœåŠ¡
â”‚   â”œâ”€â”€ start-finance.ps1         # å¯åŠ¨è´¢åŠ¡æœåŠ¡
â”‚   â””â”€â”€ README.md                 # è¿è¡Œè„šæœ¬è¯´æ˜
â”œâ”€â”€ test/                          # æµ‹è¯•ç›¸å…³è„šæœ¬
â”‚   â”œâ”€â”€ build-test.ps1            # ç¼–è¯‘æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ type-check.ps1            # ç±»å‹æ£€æŸ¥è„šæœ¬
â”‚   â”œâ”€â”€ full-test.ps1             # å®Œæ•´æµ‹è¯•è„šæœ¬
â”‚   â””â”€â”€ README.md                 # æµ‹è¯•è„šæœ¬è¯´æ˜
â”œâ”€â”€ init-db.sql                   # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ prometheus.yml                # Prometheus é…ç½®
â””â”€â”€ README.md                     # æœ¬æ–‡ä»¶
```

## ğŸš€ æœåŠ¡ç®¡ç†è„šæœ¬

### å¯åŠ¨å•ä¸ªæœåŠ¡

å¿«é€Ÿå¯åŠ¨æŸä¸ªç‰¹å®šæœåŠ¡ï¼Œé€‚åˆå¼€å‘è°ƒè¯•ï¼š

```powershell
# ä½¿ç”¨ pnpm å‘½ä»¤ï¼ˆæ¨èï¼‰
pnpm run start:gateway      # å¯åŠ¨ API ç½‘å…³ (7001)
pnpm run start:auth         # å¯åŠ¨è®¤è¯æœåŠ¡ (7000)
pnpm run start:customer     # å¯åŠ¨å®¢æˆ·æœåŠ¡ (7002)
pnpm run start:acquisition  # å¯åŠ¨è·å®¢æœåŠ¡ (7003)
pnpm run start:operation    # å¯åŠ¨è¿è¥æœåŠ¡ (7004)
pnpm run start:asset        # å¯åŠ¨ç´ ææœåŠ¡ (7005)
pnpm run start:message      # å¯åŠ¨æ¶ˆæ¯æœåŠ¡ (7006)
pnpm run start:integration  # å¯åŠ¨é›†æˆæœåŠ¡ (7007)
pnpm run start:analytics    # å¯åŠ¨åˆ†ææœåŠ¡ (7008)
pnpm run start:finance      # å¯åŠ¨è´¢åŠ¡æœåŠ¡ (7009)

# æˆ–ç›´æ¥æ‰§è¡Œè„šæœ¬
.\scripts\run\start-gateway.ps1
.\scripts\run\start-auth.ps1
# ... å…¶ä»–æœåŠ¡
```

**æ›´å¤šè¯¦æƒ…**: æŸ¥çœ‹ [run/README.md](run/README.md)

### å¯åŠ¨æ‰€æœ‰æœåŠ¡

ä¸€é”®å¯åŠ¨æ‰€æœ‰10ä¸ªåç«¯å¾®æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡åœ¨ç‹¬ç«‹çª—å£ä¸­è¿è¡Œã€‚

```powershell
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
.\scripts\run\start-all-services.ps1

# æˆ–ä½¿ç”¨ npm å‘½ä»¤
pnpm run start:all
```

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- âœ… è‡ªåŠ¨æ£€æŸ¥ pnpm æ˜¯å¦å®‰è£…
- âœ… è‡ªåŠ¨æ£€æŸ¥å¹¶å®‰è£…ä¾èµ–
- âœ… æ¯ä¸ªæœåŠ¡ç‹¬ç«‹çª—å£ï¼Œä¾¿äºæŸ¥çœ‹æ—¥å¿—
- âœ… æ˜¾ç¤ºå¯åŠ¨è¿›åº¦å’Œç»“æœ
- âœ… å¯åŠ¨å¤±è´¥è‡ªåŠ¨æç¤º
- âœ… æ˜¾ç¤ºæœåŠ¡åœ°å€åˆ—è¡¨

**å¯åŠ¨çš„æœåŠ¡ï¼š**
- gateway-service (7001) - APIç½‘å…³
- auth-service (7000) - è®¤è¯æˆæƒæœåŠ¡
- customer-service (7002) - å®¢æˆ·ç®¡ç†æœåŠ¡
- acquisition-service (7003) - è·å®¢æœåŠ¡
- operation-service (7004) - è¿è¥ç®¡ç†æœåŠ¡
- asset-service (7005) - ç´ æç®¡ç†æœåŠ¡
- message-service (7006) - æ¶ˆæ¯ç®¡ç†æœåŠ¡
- integration-service (7007) - ä¼å¾®é›†æˆæœåŠ¡
- analytics-service (7008) - æ•°æ®åˆ†ææœåŠ¡
- finance-service (7009) - è´¢åŠ¡ç®¡ç†æœåŠ¡

### åœæ­¢æ‰€æœ‰æœåŠ¡

åœæ­¢æ‰€æœ‰è¿è¡Œä¸­çš„åç«¯æœåŠ¡ã€‚

```powershell
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
.\scripts\run\stop-all-services.ps1

# æˆ–ä½¿ç”¨ npm å‘½ä»¤
pnpm run stop:all
```

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- âœ… è‡ªåŠ¨æ£€æµ‹ç«¯å£ 7000-7009 ä¸Šçš„è¿›ç¨‹
- âœ… å¼ºåˆ¶ç»ˆæ­¢æ‰€æœ‰ç›¸å…³è¿›ç¨‹
- âœ… æ˜¾ç¤ºç»ˆæ­¢è¿›åº¦å’Œç»“æœ
- âœ… å®‰å…¨å¤„ç†ï¼Œä¸å½±å“å…¶ä»–è¿›ç¨‹

### æ£€æŸ¥æœåŠ¡çŠ¶æ€

æ£€æŸ¥æ‰€æœ‰æœåŠ¡çš„è¿è¡ŒçŠ¶æ€å’Œå¥åº·åº¦ã€‚

```powershell
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
.\scripts\run\check-services.ps1

# æˆ–ä½¿ç”¨ npm å‘½ä»¤
pnpm run check:services
```

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- âœ… æ£€æŸ¥ç«¯å£å ç”¨æƒ…å†µ
- âœ… è®¿é—®å¥åº·æ£€æŸ¥æ¥å£
- âœ… æ˜¾ç¤ºæ¯ä¸ªæœåŠ¡çš„çŠ¶æ€
- âœ… æ±‡æ€»è¿è¡Œç»Ÿè®¡

## ğŸ§ª æµ‹è¯•è„šæœ¬

æµ‹è¯•ç›¸å…³è„šæœ¬ä½äº `test/` ç›®å½•ä¸‹ï¼Œè¯¦è§ [test/README.md](test/README.md)ã€‚

### å¿«é€Ÿæµ‹è¯•

```powershell
# å®Œæ•´æµ‹è¯•ï¼ˆç¼–è¯‘ + ç±»å‹æ£€æŸ¥ï¼‰
pnpm run test

# ä»…ç¼–è¯‘æµ‹è¯•
pnpm run test:build

# ä»…ç±»å‹æ£€æŸ¥
pnpm run test:type
```

## ğŸ’¾ æ•°æ®åº“è„šæœ¬

### åˆå§‹åŒ–æ•°æ®åº“

```bash
mysql -u root -p < scripts/init-db.sql
```

åˆå§‹åŒ–è„šæœ¬åŒ…å«ï¼š
- åˆ›å»ºæ•°æ®åº“
- åˆ›å»ºæ•°æ®è¡¨
- åˆå§‹åŒ–åŸºç¡€æ•°æ®

## ğŸ“Š ç›‘æ§é…ç½®

### Prometheus

Prometheus é…ç½®æ–‡ä»¶ï¼š`prometheus.yml`

å¯åŠ¨ Prometheusï¼ˆä½¿ç”¨ Dockerï¼‰ï¼š

```bash
docker run -d \
  --name prometheus \
  -p 9090:9090 \
  -v $(pwd)/scripts/prometheus.yml:/etc/prometheus/prometheus.yml \
  prom/prometheus
```

è®¿é—® Prometheusï¼šhttp://localhost:9090

## ğŸ”§ ä½¿ç”¨è¯´æ˜

### 1. é¦–æ¬¡å¯åŠ¨

```powershell
# 1. å¯åŠ¨æ•°æ®åº“å’Œä¸­é—´ä»¶
docker-compose up -d

# 2. åˆå§‹åŒ–æ•°æ®åº“
mysql -u root -p < scripts/init-db.sql

# 3. å®‰è£…ä¾èµ–
pnpm install

# 4. å¯åŠ¨æ‰€æœ‰æœåŠ¡
.\scripts\run\start-all-services.ps1
```

### 2. æ—¥å¸¸å¼€å‘

```powershell
# æ–¹å¼1: å¯åŠ¨æ‰€æœ‰æœåŠ¡
pnpm run start:all

# æ–¹å¼2: åªå¯åŠ¨éœ€è¦çš„æœåŠ¡ï¼ˆæ¨èï¼‰
pnpm run start:gateway      # APIç½‘å…³
pnpm run start:auth         # è®¤è¯æœåŠ¡
pnpm run start:customer     # å®¢æˆ·æœåŠ¡

# æ£€æŸ¥çŠ¶æ€
pnpm run check:services

# è¿è¡Œæµ‹è¯•
pnpm run test

# åœæ­¢æœåŠ¡
pnpm run stop:all
```

### 3. å¼€å‘ç‰¹å®šåŠŸèƒ½

```powershell
# å¼€å‘å®¢æˆ·ç®¡ç†åŠŸèƒ½
pnpm run start:gateway      # å¯åŠ¨ç½‘å…³
pnpm run start:auth         # å¯åŠ¨è®¤è¯
pnpm run start:customer     # å¯åŠ¨å®¢æˆ·æœåŠ¡

# å¼€å‘æ¶ˆæ¯åŠŸèƒ½
pnpm run start:gateway      # å¯åŠ¨ç½‘å…³
pnpm run start:auth         # å¯åŠ¨è®¤è¯
pnpm run start:message      # å¯åŠ¨æ¶ˆæ¯æœåŠ¡
pnpm run start:integration  # å¯åŠ¨é›†æˆæœåŠ¡ï¼ˆå¦‚éœ€ä¼å¾®æ¶ˆæ¯ï¼‰
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç«¯å£å ç”¨**ï¼šå¯åŠ¨å‰è¯·ç¡®ä¿ç«¯å£ 7000-7009 æœªè¢«å ç”¨
2. **ä¾èµ–æœåŠ¡**ï¼šç¡®ä¿ MySQLã€Redis ç­‰ä¾èµ–æœåŠ¡å·²å¯åŠ¨
3. **ç¯å¢ƒé…ç½®**ï¼šæ£€æŸ¥ `.env` æ–‡ä»¶æ˜¯å¦æ­£ç¡®é…ç½®
4. **æƒé™é—®é¢˜**ï¼šWindows ä¸Šå¯èƒ½éœ€è¦ç®¡ç†å‘˜æƒé™
5. **é˜²ç«å¢™**ï¼šç¡®ä¿é˜²ç«å¢™å…è®¸è¿™äº›ç«¯å£çš„è®¿é—®

## ğŸ› æ•…éšœæ’æŸ¥

### æœåŠ¡å¯åŠ¨å¤±è´¥

1. æ£€æŸ¥ä¾èµ–æ˜¯å¦å®‰è£…ï¼š`pnpm install`
2. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼š`netstat -ano | findstr "7000"`
3. æ£€æŸ¥æ•°æ®åº“è¿æ¥ï¼šæŸ¥çœ‹ `.env` é…ç½®
4. æŸ¥çœ‹æœåŠ¡æ—¥å¿—ï¼šåœ¨æœåŠ¡çª—å£ä¸­æŸ¥çœ‹é”™è¯¯ä¿¡æ¯

### æœåŠ¡æ— æ³•è®¿é—®

1. æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼š`.\scripts\check-services.ps1`
2. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
3. æ£€æŸ¥å¥åº·æ£€æŸ¥æ¥å£ï¼š`http://localhost:7001/health`

### åœæ­¢è„šæœ¬æ— æ•ˆ

```powershell
# æ‰‹åŠ¨æŸ¥æ‰¾å¹¶ç»ˆæ­¢è¿›ç¨‹
netstat -ano | findstr "7001"
taskkill /PID <è¿›ç¨‹ID> /F
```

## ğŸ“ ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹](../å¿«é€Ÿå¼€å§‹.md)
- [æµ‹è¯•æ–‡æ¡£](../TESTING.md)
- [å¼€å‘æŒ‡å—](../docs/development/)
- [APIæ–‡æ¡£](../docs/api/)

## ğŸ’¡ æç¤º

- ä½¿ç”¨ `start-all-services.ps1` æ—¶ï¼Œæ¯ä¸ªæœåŠ¡ä¼šåœ¨ç‹¬ç«‹çª—å£ä¸­å¯åŠ¨ï¼Œä¾¿äºæŸ¥çœ‹æ—¥å¿—
- å¯ä»¥å…³é—­ä»»æ„æœåŠ¡çª—å£æ¥åœæ­¢å¯¹åº”æœåŠ¡
- å»ºè®®ä½¿ç”¨ `check-services.ps1` å®šæœŸæ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
- å¼€å‘æ—¶å¯ä»¥åªå¯åŠ¨éœ€è¦çš„æœåŠ¡ï¼Œæ— éœ€å…¨éƒ¨å¯åŠ¨
